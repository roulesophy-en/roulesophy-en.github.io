---
filename: 2017-08-19-Jekyll-教學（五）：建立關聯文章.md
layout: post
title: Jekyll 教學（五）：建立關聯文章
tags: Programming
date: 2017-08-19
comments: true
---
{% raw  %}
 
這篇是在每篇網誌後加上關聯文章，我們會以文章有相同的 tag 來決定這是關聯的文章。

在 `_layouts/post.html` 中加上關聯文章的程式碼：  
`_layouts/post.html`
```
---
layout: default
---

<article class="post">
  <h1>{{ page.title }}</h1>

  <div class="entry">
    {{ content }}
  </div>

  <div>
  Tags: 
    {% for tag in page.tags %}
      <a href="/tags#{{ tag }}" class="tag">{{ tag }}</a>
    {% endfor %}
    <p>
  </div>

  <div class="date">
    Written on {{ page.date | date: "%B %e, %Y" }}
  </div>

  <div class="relatedPosts">
	  {% assign maxRelated = 5 %}
	  {% assign minCommonTags = 1 %}
	  {% assign maxRelatedCounter = 0 %}
	  {% assign showRelatedPost = 0 %}
	  {% assign relatedPost = '' %}
	  {% for post in site.posts %}
	    {% assign sameTagCount = 0 %}
	    {% assign commonTags = '' %}
	    {% for tag in post.tags %}
	      {% if post.url != page.url %}
	        {% if page.tags contains tag %}
	          {% assign sameTagCount = sameTagCount | plus: 1 %}
	          {% capture tagmarkup %} <span class="label label-default">{{ tag }}</span> {% endcapture %}
	          {% assign commonTags = commonTags | append: tagmarkup %}
	        {% endif %}
	      {% endif %}
	    {% endfor %}
	    {% if sameTagCount >= minCommonTags %}
	      {% capture relatedPostPoint %} <li><a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a></li> {% endcapture %}
	      {% assign relatedPost = relatedPost | append: relatedPostPoint %}
	      {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
	      {% assign showRelatedPost = showRelatedPost | plus: 1 %}
	      {% if maxRelatedCounter >= maxRelated %}
	        {% break %}
	      {% endif %}
	    {% endif %}
	  {% endfor %}
	  {% if showRelatedPost >= 1 %}
		  <h3>Related post:</h3>
		  <ul>
		    {{ relatedPost }}
		  </ul> 
	  {% endif %}
	</div>

  {% if page.comments %}
    {% include disqus.html %}
  {% endif %}
</article>
```
{% endraw %}
